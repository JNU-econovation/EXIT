<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>글쓰기</title>
    <script src="../docs/js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="../docs/js/examples-base.js"></script>
    <script type="text/javascript" src="../docs/js/highlight.min.js"></script>
    <script type="text/javascript"
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=83bfuniegk&amp;submodules=panorama"></script>
    <link rel="stylesheet" type="text/css" href="../docs/css/examples-base.css" />
    <script>
        var HOME_PATH = '../docs';
    </script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>

    <!-- @category Map --> 

    <div id="wrap" class="section">
        <h2>위치 선택하기</h2>
        <p>글을 작성하고 싶은 위치를 선택하세요.</p>
        <div id="map" style="width:100%;height:600px;"></div>
    </div>
    <script>
        let map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(35.176117, 126.905834),
            zoom: 30,
            mapTypeId: naver.maps.MapTypeId.NORMAL
        });

        var marker = new naver.maps.Marker({
            position: new naver.maps.LatLng(37.3595704, 127.105399),
            map: map
        });

        var infowindow = new naver.maps.InfoWindow({
        });

        function onSuccessGeolocation(position) {
            var location = new naver.maps.LatLng(position.coords.latitude,
                position.coords.longitude);

            map.setCenter(location); // 얻은 좌표를 지도의 중심으로 설정합니다.
            map.setZoom(13); // 지도의 줌 레벨을 변경합니다.

            marker.setPosition(location);

            console.log('Coordinates: ', location);

            let circle = new naver.maps.Circle({
                strokeColor: '#0000ff',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#0000ff',
                fillOpacity: 0.35,
                center: location,
                radius: 100,
                zIndex: 100,
                clickable: true,
                map: map
            });
            naver.maps.Event.addListener(circle, "click", function (e) {
                let lat = e.coord.lat(); //클릭한 위치로 위도 변경
                let lng = e.coord.lng(); //클릭한 위치로 경도 변경
                let location = new naver.maps.LatLng(lat, lng);
                console.log(e.coord.lat() + ',' + e.coord.lng());
                infowindow.setPosition(location);
                infowindow.setContent('<div class="iw_inner"><h2>글을 작성하세요.</h2><textarea id="text" rows="7" cols="60"></textarea><br><button id="write" type="submit">저장</button></div>');4
                infowindow.open(map);
                document.getElementById("write").addEventListener("click",(e)=>{
                    axios.post("/board/write",{ 
                        latitude : lat,
                        longitude : lng,
                        text : document.getElementById('text').value
                    }).then(res =>{
                        alert("등록 성공");                        
                    }).catch(function (error) {
                        alert(error);
                      });
                })
            })
        }

        function onErrorGeolocation() {
            var center = map.getCenter();

            infowindow.setContent('<div style="padding:20px;">' +
                '<h5 style="margin-bottom:5px;color:#f00;">Geolocation failed!</h5>' + "latitude: " + center.lat() + "<br />longitude: " + center.lng() + '</div>');

            infowindow.open(map, center);
        }

        $(window).on("load", function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(onSuccessGeolocation, onErrorGeolocation);
            } else {
                var center = map.getCenter();
                infowindow.setContent('<div style="padding:20px;"><h5 style="margin-bottom:5px;color:#f00;">Geolocation not supported</h5></div>');
                infowindow.open(map, center);
            }
        });

// naver.maps.Event.addListener(map, "click", function(e) {

//     let lat = e.coord.lat(); //클릭한 위치로 위도 변경
//     let lng = e.coord.lng(); //클릭한 위치로 경도 변경
// });

    </script>
</body>

</html>